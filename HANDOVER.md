# HANDOVER.md

## 今回の作業内容

### 完了したこと
- **フリーズ原因の調査と特定**: ローカルビルド時のリソース制限解除（`BUILD_LIMITS=""`）によるシステムハングを特定しました。
- **GitHub Actions (GHA) への移行**: ローカル環境の負荷軽減のため、ビルド・デプロイプロセスを GHA へ完全に移行しました。
- **Phase 5: GitHubデプロイと本番設定**: 完了。
- **メンテナンスモードの導入**: 高品質なメンテナンスページを実装し、[AntigravityProjects](https://maque-bit.github.io/AntigravityProjects/) に適用しました。
- **デプロイパスの修正**: GitHub Pages の 404 エラーを解消するため、Astro の `site`/`base` 設定と GHA ワークフローを修正しました。
- **技術引き継ぎ資料の整備**: [technical_handover.md](file:///home/maki/projects/MCP4Antigravity/docs/technical_handover.md) を作成済み。

### 対応中のこと
- 特になし（Phase 5 の実装完了）。

### 未対応のこと
- **実際の運用監視**: GHA での継続的なデプロイ成否のモニタリング。
- **Phase 6 以降の事業計画**: プロジェクト完了後の運用フェーズ。

## 決定した方針・設計
- **ビルド環境**: ローカルビルドを廃止し、GitHub Actions での並列ビルドを標準としました。
- **イメージサイズ最適化**: 本番用ステージでは `npm ci --only=production` を強制し、不要な devDependencies を除外しました。
- **秘匿情報の管理**: `GEMINI_API_KEY` などの機密情報は、リポジトリの設定（GitHub Secrets）で管理し、ビルド引数として渡す構成にしました。

## 発生した問題と対応
- **問題**: ローカル環境での `podman build` 中にシステムがフリーズした。
  - **原因**: 速度優先のために CPU リソース制限を解除しており、全コアがビルドに占有されたため。
  - **対応**: ローカルビルドを中止し、非力なマシンでも開発を継続できるよう GHA でのリモートビルドへ移行。
  - **結果**: ローカルリソースを消費せずに、安定して全サービスのビルド・デプロイが可能になりました。

## 学んだこと
- ローカル環境でのコンテナビルドは、特に複数の JS プロジェクトが並走する場合、予想以上に CPU/メモリを消費する。
- 低スペック環境では最初から GitHub Actions などのリモートリソースを前提とした CI/CD パイプラインを組むことが、ハングによる作業中断を防ぐために不可欠である。
