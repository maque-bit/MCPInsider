---
export interface Props {
  project: {
    name: string;
    description: string;
    url: string;
    analysis: {
      summary_ja: string;
      catchphrase: string;
      wow_factor: string;
      dev_utility: number;
      category: string[];
      safety_level: string;
      use_cases: string[];
    };
  };
  viewMode: 'grid' | 'list';
}

const { project, viewMode } = Astro.props;
const slug = encodeURIComponent(project.url);

// A color map for categories, matching the vibrant mockup style
const categoryColors: Record<string, string> = {
  'DevTools': 'bg-fuchsia-500 text-white',
  'API': 'bg-blue-500 text-white',
  'Automation': 'bg-emerald-500 text-white',
  'Utility': 'bg-indigo-500 text-white',
  'Search': 'bg-violet-500 text-white',
  'Database': 'bg-pink-500 text-white',
};

function getCategoryColor(cat: string) {
  return categoryColors[cat] || 'bg-blue-400 text-white';
}
---

{viewMode === 'grid' ? (
  <a href={`/projects/${slug}`} class="block group h-full">
    <article class="bg-white/80 backdrop-blur-sm rounded-xl shadow-[0_4px_20px_rgb(0,0,0,0.03)] border border-white/60 hover:shadow-[0_8px_25px_rgb(59,130,246,0.08)] hover:border-blue-200/60 transition-all duration-300 p-5 h-full flex flex-col relative overflow-hidden">
      
      <div class="flex flex-wrap gap-1.5 mb-3">
        {project.analysis.category.slice(0, 2).map(cat => (
          <span class={`text-[10px] tracking-wide font-bold px-1.5 py-0.5 rounded shadow-sm ${getCategoryColor(cat)}`}>
            {cat}
          </span>
        ))}
      </div>
      
      <h3 class="text-base font-extrabold text-gray-900 group-hover:text-blue-600 transition-colors line-clamp-2 mb-1.5">{project.name}</h3>
      <p class="text-[12px] text-gray-500 line-clamp-3 leading-relaxed flex-1 mb-4">{project.analysis.summary_ja}</p>
      
      <div class="mt-auto pt-3 border-t border-gray-100/80">
        <div class="flex flex-col">
          <span class="text-[11px] font-semibold text-gray-600 mb-1">Dev Utility: <span class="text-gray-900 font-bold">{project.analysis.dev_utility}/10</span></span>
          <div class="h-1 w-12 bg-gradient-to-r from-cyan-400 to-blue-500 rounded-full group-hover:w-16 transition-all duration-300"></div>
        </div>
      </div>
        <div class="flex items-center text-[11px] font-medium text-gray-500 border-t border-gray-100 pt-2 mt-2">
          <span class="font-bold text-gray-700 flex items-center gap-1">
             âœ¨ Wow Factor: 
          </span>
          <span class="truncate ml-1 text-gray-500">{project.analysis.wow_factor}</span>
        </div>
      </div>
    </article>
  </a>
) : (
  <a href={`/projects/${slug}`} class="block group">
    <article class="bg-white/80 backdrop-blur-sm shadow-[0_2px_10px_rgb(0,0,0,0.02)] rounded-lg border border-white/60 hover:bg-white/95 hover:shadow-[0_4px_15px_rgb(59,130,246,0.05)] hover:border-blue-200/50 transition-all duration-300 p-4 flex flex-col md:flex-row gap-4 md:items-center">
      
      <div class="flex flex-col md:flex-row gap-4 flex-1 min-w-0 md:items-center">
        <div class="flex gap-1.5 shrink-0">
          {project.analysis.category.slice(0, 1).map(cat => (
            <span class={`text-[9px] tracking-wide font-bold px-1.5 py-0.5 rounded shadow-sm whitespace-nowrap ${getCategoryColor(cat)}`}>
              {cat}
            </span>
          ))}
        </div>
        
        <div class="flex-1 min-w-0">
          <h3 class="text-base font-extrabold text-gray-900 group-hover:text-blue-600 transition-colors truncate mb-0.5">{project.name}</h3>
          <p class="text-[12px] text-gray-500 truncate">{project.analysis.summary_ja}</p>
        </div>
      </div>

      <div class="flex flex-col md:items-end shrink-0 pl-1 md:pl-4 md:border-l border-gray-100/80">
         <span class="text-[11px] font-semibold text-gray-600 mb-1">Dev Utility: <span class="text-gray-900 font-bold">{project.analysis.dev_utility}/10</span></span>
         <div class="h-1 w-12 bg-gradient-to-r from-cyan-400 to-blue-500 rounded-full group-hover:w-16 transition-all duration-300"></div>
      </div>
    </article>
  </a>
)}
